<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="dashboard.css">
  <title>Dashboard</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Dela+Gothic+One&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Delius&display=swap');

    /* ✅ Added basic styles for Edit and Delete buttons */
    .editbtn, .deletebtn {
      padding: 8px 12px;
      font-size: 14px;
      margin: 0 5px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: white;
    }
    .editbtn {
      background-color: #007bff;
    }
    .deletebtn {
      background-color: #dc3545;
    }
  </style>
</head>
<body>

  <div class="headnav">
    <h1 class="icon">II BSIT A</h1>
  </div>

  <div class="container">
    <h1 class="dashboard-title">Dashboard</h1>
    <p class="dashboard-description">Welcome to your dashboard! Here you can manage your movies, view ratings, and more.</p>
  </div>

  <div class="search-box">
    <input type="text" id="search" placeholder="Search movies..." class="search-input">
    <button type="submit" class="addbtn" onclick="addtoggle()">Add</button>
    <button type="submit" class="retrievebtn" onclick="retrieveMovies()">Retrieve</button> <!--  Added onclick -->
  </div>

  <div class="table-container">
    <h2>Movie List</h2>
    <table id="moviesTable">
      <thead>
        <tr>
          <th>Title</th>
          <th>Director</th>
          <th>Release Year</th>
          <th>Rating</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
       
      </tbody>
    </table>
  </div>


  <div id="popup">
    <h1 class="addtxt">Add</h1>
    <span>Title:</span>
    <input type="text" id="title" placeholder="Movie Title" class="input-field">
    <span>Director:</span>
    <input type="text" id="director" placeholder="Director" class="input-field">
    <span>Release year:</span>
    <input type="text" id="release_year" placeholder="Release year" class="input-field">
    <span>Ratings:</span>
    <input type="text" id="rating" placeholder="Ratings" class="input-field">

    <div class="btn">
      <button onclick="addtoggle2();" class="btnclose">Close</button>
      <button onclick="createMovies();" class="btnadd">Add</button>
    </div>
  </div>

  <script>
    function addtoggle() {
      const popup = document.getElementById('popup');
      popup.classList.toggle('active');
    }

    function addtoggle2() {
      const popup = document.getElementById('popup');
      popup.classList.toggle('active');
    }

    //CREATE MOVIE
    function createMovies() {
      const title = document.getElementById("title").value;
      const director = document.getElementById("director").value;
      const release_year = document.getElementById("release_year").value;
      const rating = document.getElementById("rating").value;

      if (!title) {
        alert("Please input Movie Title");
        return;
      }

      const Movies = { title, director, release_year, rating };

      fetch("http://127.0.0.1:3000/addmovies", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(Movies),
      })
      .then((response) => {
        if (!response.ok) throw new Error("Network response was not OK");
        return response.json();
      })
      .then((data) => {

        alert( data.id + "." +" "+ title +" by " + director + " is added successfully!");
        document.getElementById("title").value = "";
        document.getElementById("director").value = "";
        document.getElementById("release_year").value = "";
        document.getElementById("rating").value = "";
        retrieveMovies(); // Refresh list
        addtoggle2();     // Close popup
      })
      .catch((error) => {
        console.error("Error:", error);
        alert("Error adding movie. Please try again.");
      });
    }

    // RETRIEVE MOVIES
    function retrieveMovies() {
      fetch("http://127.0.0.1:3000/movies")

        .then((response) => response.json())
        .then((movies) => {
          const tbody = document.querySelector("#moviesTable tbody");
          tbody.innerHTML = ""; // Clear table before adding

          movies.forEach((movie) => {
            const row = document.createElement("tr");
            row.innerHTML = `
              <td>${movie.title}</td>
              <td>${movie.director}</td>
              <td>${movie.release_year}</td>
              <td>${movie.rating}</td>
              <td></td>
            `;

            // ✅ Add Edit and Delete buttons
            const actionsCell = row.querySelector("td:last-child");

            const editBtn = document.createElement("button");
            editBtn.textContent = "Edit";
            editBtn.className = "editbtn";
            // Future: editBtn.onclick = () => editMovie(movie.id);

            const deleteBtn = document.createElement("button");
            deleteBtn.textContent = "Delete";
            deleteBtn.className = "deletebtn";
            // Future: deleteBtn.onclick = () => deleteMovie(movie.id);

            actionsCell.appendChild(editBtn);
            actionsCell.appendChild(deleteBtn);

            tbody.appendChild(row);
          });
        })
        .catch((error) => {
          console.error("Error fetching movies:", error);
          alert("Failed to load movie list.");
        });
    }
    // ✅ Call retrieve on page load
    window.onload = retrieveMovies;
  </script>
</body>
</html>
